{{- define "main" -}}
  <section class="home-page">
    {{- $lang := .Site.Language.Lang -}}
    {{- $home := (index site.Data $lang "home") | default (index site.Data "us" "home") -}}
    {{- $ui   := (index site.Data $lang "ui")   | default (index site.Data "us" "ui") -}}

    {{- /* hero: читаем заголовок с фоллбеком */ -}}
    {{- $hero := $home.hero -}}
    {{- $hTitle := or $hero.title $home.title -}}


    <section class="hero">
      <h1>{{ $hTitle }}</h1>

      {{- with $hero.subtitle -}}
        <p class="tagline">{{ . }}</p>
      {{- end -}}

      {{- with $hero.highlights -}}
        <ul class="sub">
          {{- range . -}}<li>{{ . }}</li>{{- end -}}
        </ul>
      {{- end -}}


      <div class="cta-row">
        {{- with $hero.primaryHref -}}
          <a class="btn" href="{{ . }}">{{ $hero.primaryText }}</a>
        {{- end -}}
        {{- with $hero.secondaryHref -}}
          <a class="btn secondary" href="{{ . }}">{{ $hero.secondaryText }}</a>
        {{- end -}}
        {{- with $hero.tertiaryHref -}}
          <a class="btn tertiary" href="{{ . }}">{{ $hero.tertiaryText }}</a>
        {{- end -}}
      </div>
    </section>

    {{/* SECTIONS */}}
    {{- range $home.sections -}}
      {{- $sec := . -}}
      {{- $secId := $sec.id -}}

      {{- if eq $sec.kind "cards" -}}
        <section {{ if $secId }}id="{{ $secId }}"{{ end }} class="section">
          <h2>{{ $sec.title }}</h2>
          <div class="grid">
            {{- range $sec.items -}}
              <div class="card">
                <h3>
                  {{- with (index . "icon") -}}
                    <span>{{ . }}</span>
                  {{- end -}}{{ index . "h" }}
                </h3>
                <p>{{ index . "p" }}</p>
                {{- with (index . "href") -}}
                  <a class="link" href="{{ . }}">Learn more →</a>
                {{- end -}}
              </div>
            {{- end -}}
          </div>
        </section>
      {{- end -}}

      {{- if eq $sec.kind "bullets" -}}
        <section {{ if $secId }}id="{{ $secId }}"{{ end }} class="section">
          <h2>{{ $sec.title }}</h2>
          <ul>
            {{- range $sec.bullets -}}<li>{{ . }}</li>{{- end -}}
          </ul>
        </section>
      {{- end -}}

      {{- if eq $sec.kind "projects" -}}
        <section {{ if $secId }}id="{{ $secId }}"{{ end }} class="section">
          <h2>{{ $sec.title }}</h2>
          <div class="grid">
            {{- range $sec.items -}}
              {{- $title := index . "title" -}}
              {{- $desc  := index . "desc" -}}
              {{- $href  := index . "href" -}}
              <div class="card">
                {{- with (index . "badge") -}}
                  <p class="sub">{{ . }}</p>
                {{- end -}}
                <h3>
                  {{- if $href -}}
                    <a href="{{ $href }}">{{ $title }}</a>
                  {{- else -}}
                    {{ $title }}
                  {{- end -}}
                </h3>
                <p>{{ $desc }}</p>
              </div>
            {{- end -}}
          </div>
        </section>
      {{- end -}}

      {{- if eq $sec.kind "vision" -}}
        <section {{ if $secId }}id="{{ $secId }}"{{ end }} class="section">
          <h2>{{ $sec.title }}</h2>
          <p>{{ $sec.text }}</p>
        </section>
      {{- end -}}

      {{- if eq $sec.kind "blog" -}}
        <section {{ if $secId }}id="{{ $secId }}"{{ end }} class="section">
          <h2>{{ $sec.title }}</h2>
          {{- $cnt := 3 -}}
          {{- with $sec.count }}{{- $cnt = . -}}{{- end -}}
          {{- $pages := first $cnt (where (where site.RegularPages "Type" "blog") "Lang" $.Site.Language.Lang) -}}
          {{- if $pages -}}
            {{- range $pages -}}
              <section class="section">
                <article class="card">
                  <h3><a href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
                  <p>
                    {{ with .Params.description }}
                      {{ . }}
                    {{ else }}
                      {{ .Summary }}
                    {{ end }}
                  </p>
                  <p class="sub">
                    {{ .Date.Format "02 Jan 2006" }}
                    {{ with .ReadingTime }}· {{ . }} min read{{ end }}
                    {{ with .Params.tags }}· {{ delimit . ", " }}{{ end }}
                  </p>
                </article>
              </section>
            {{- end -}}
          {{- else -}}
            <p class="sub">No posts yet.</p>
          {{- end -}}
          {{- with $sec.ctaHref -}}
            <p><a class="link" href="{{ . }}">{{ $sec.ctaText }} →</a></p>
          {{- end -}}
        </section>
      {{- end -}}

      {{- if eq $sec.kind "cta" -}}
        <section {{ if $secId }}id="{{ $secId }}"{{ end }} class="section">
          <h2>{{ $sec.title }}</h2>
          <p>{{ $sec.text }}</p>
          {{- with $sec.primaryHref -}}
            <a class="btn" href="{{ . }}">{{ $sec.primaryText }}</a>
          {{- end -}}
        </section>
      {{- end -}}
    {{- end -}}
  </section>
{{- end -}}
