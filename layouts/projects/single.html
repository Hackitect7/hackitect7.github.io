{{- define "main" -}}
  {{- $lang := .Site.Language.Lang -}}

  {{/* UI-строки */}}
  {{- $stackLbl     := partial "t.html" (dict "key" "ui.projects.stack"     "ctx" .) -}}
  {{- $linksTitle   := partial "t.html" (dict "key" "ui.projects.linksTitle" "ctx" .) -}}
  {{- $demoLbl      := partial "t.html" (dict "key" "ui.projects.demo"       "ctx" .) -}}
  {{- $moreLbl      := partial "t.html" (dict "key" "ui.projects.more"       "ctx" .) -}}
  {{- $backToList   := partial "t.html" (dict "key" "ui.projects.backToList" "ctx" .) -}}

  <!-- HERO -->
  <section class="hero section">
    <h1>{{ .Title }}</h1>
    {{ with .Params.description }}<p class="tagline">{{ . }}</p>{{ end }}
    {{ with .Params.badge }}<p class="sub">{{ . }}</p>{{ end }}
  </section>

  <!-- COVER (optional) -->
  {{ with .Params.cover }}
    <figure class="section card" style="padding:0; overflow:hidden">
      <img src="{{ . | relURL }}" alt="{{ $.Title }}" style="display:block; width:100%; height:auto" loading="lazy" decoding="async" />
    </figure>
  {{ end }}

  <!-- META: stack + quick links (optional) -->
  {{ if or .Params.stack (or .Params.repo (or .Params.demo .Params.links)) }}
    <section class="section">
      <div class="grid">
        {{ with .Params.stack }}
          <div class="card">
            <h3>{{ $stackLbl }}</h3>
            <ul>
              {{ range . }}<li>{{ . }}</li>{{ end }}
            </ul>
          </div>
        {{ end }}

        {{ if or .Params.repo (or .Params.demo .Params.links) }}
          <div class="card">
            <h3>{{ $linksTitle }}</h3>
            <div class="cta-row">
              {{ with .Params.demo }}<a class="btn"          href="{{ . }}">{{ $demoLbl }}</a>{{ end }}
              {{ with .Params.repo }}<a class="btn secondary" href="{{ . }}">GitHub</a>{{ end }}
              {{ with .Params.links }}
                {{ range . }}
                  {{- $text := .text | default "Link" -}}
                  {{- $href := .href -}}
                  {{- $kind := .kind | default "tertiary" -}}
                  {{ if $href }}<a class="btn {{ $kind }}" href="{{ $href }}">{{ $text }}</a>{{ end }}
                {{ end }}
              {{ end }}
            </div>
          </div>
        {{ end }}
      </div>
    </section>
  {{ end }}

  <!-- CONTENT -->
  <article class="section card">
    {{ .Content }}
    {{ with .Params.highlights }}
      <ul class="bullets" style="margin-top:12px">
        {{ range . }}<li>{{ . }}</li>{{ end }}
      </ul>
    {{ end }}
  </article>

  <!-- GALLERY (optional) -->
  {{ with .Params.images }}
    <section class="section">
      <div class="grid">
        {{ range . }}
          {{- $src := (cond (reflect.IsMap .) (.src) .) -}}
          {{- $alt := (cond (reflect.IsMap .) ((or .alt $.Title)) $.Title) -}}
          {{ if $src }}
            <figure class="card" style="padding:0; overflow:hidden">
              <img src="{{ $src | relURL }}" alt="{{ $alt }}" style="display:block; width:100%; height:auto" loading="lazy" decoding="async" />
            </figure>
          {{ end }}
        {{ end }}
      </div>
    </section>
  {{ end }}

  <!-- BACK TO LIST -->
  <section class="section card" style="text-align:center">
    <h2>{{ $moreLbl }}</h2>
    <a class="btn" href="{{ "/projects/" | relLangURL }}">{{ $backToList }}</a>
  </section>
{{- end -}}
