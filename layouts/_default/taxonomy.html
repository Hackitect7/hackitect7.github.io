{{- define "main" -}}
  {{- $lang    := .Site.Language.Lang -}}
  {{- $newer   := partial "t.html" (dict "key" "ui.blog.newer"       "ctx" . "default" "Newer") -}}
  {{- $older   := partial "t.html" (dict "key" "ui.blog.older"       "ctx" . "default" "Older") -}}
  {{- $empty   := partial "t.html" (dict "key" "ui.blog.empty"       "ctx" . "default" "No posts yet.") -}}
  {{- $minRead := partial "t.html" (dict "key" "ui.blog.minRead"     "ctx" . "default" "min read") -}}
  {{- $dateFmt := printf "%s" (partial "t.html" (dict "key" "ui.blog.dateFormat" "ctx" . "default" "Jan 02, 2006")) -}}


  <section class="blog-page taxonomy-page tax-{{ .Data.Singular }}">
    <!-- HERO -->
    <section class="hero section">
      {{- $taxPlural := title .Data.Plural -}}
      <h1>{{ printf "%s · %s" .Title $taxPlural }}</h1>
    </section>

    <div class="services-layout section">
      <div class="services-content">
        {{- /* Только текущий язык, свежие сверху */ -}}
        {{- $src := where .Pages "Lang" $lang -}}
        {{- $pages := sort $src "Date" "desc" -}}
        {{- $p := .Paginate $pages -}}

        {{- if $p.Pages -}}
          {{- range $p.Pages -}}
            <article class="card section">
              <h3><a href="{{ .RelPermalink }}">{{ .Title }}</a></h3>
              <p>
                {{ with .Params.description }}
                  {{ . }}
                {{ else }}
                  {{ .Summary }}
                {{ end }}
              </p>
              <p class="sub">
                {{- $iso := .Date.Format "2006-01-02T15:04:05Z07:00" -}}
                <time datetime="{{ $iso }}">{{ .Date.Format $dateFmt }}</time>
                {{- with .ReadingTime -}}· {{ . }} {{ $minRead }}{{- end -}}
                {{- with .Params.tags -}}· {{ delimit . ", " }}{{- end -}}
              </p>
            </article>
          {{- end -}}

          {{- if gt $p.TotalPages 1 -}}
            <nav class="cta-row section" aria-label="Pagination">
              {{- if $p.HasPrev -}}
                <a class="btn secondary" href="{{ $p.Prev.URL }}"
                  >← {{ $newer }}</a
                >
              {{- end -}}
              {{- if $p.HasNext -}}
                <a class="btn secondary" href="{{ $p.Next.URL }}"
                  >{{ $older }} →</a
                >
              {{- end -}}
            </nav>
          {{- end -}}
        {{- else -}}
          <p class="sub section">{{ $empty }}</p>
        {{- end -}}
      </div>
    </div>
  </section>
{{- end -}}
